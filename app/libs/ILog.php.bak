<?php
/**
 * ILog.php
 *
 * @date          	2014-1-2	
 * @Copyright     	(c)2012 Weedo Inc. All Rights Reserved
 * @Author        	shanks <shanks@weedo.hk>
 * @Version       	1.0.0
 */
 
require_once (WEEDOLIB_PATH . 'libs/Logger.php');
require_once (WEEDOLIB_PATH . 'config/errorCode.inc.php');

define("REMOTE_LOG_SVR_HOST", "10.212.193.34")
define("REMOTE_LOG_SVR_PORT", "80")
class ILog
{	
	public $errCode = 0;
	public $errMsg = '';
	
	private function _clearERR()
	{
		$this->errCode = 0;
		$this->errMsg = '';
	}
	
	public static function writeErrLog($errCode, $arrParam = array())
 	{
 		global $postParameter;
 		$ver 	= $postParameter['ver'];
		$appId 	= $postParameter['appId'];
		$appVer = $postParameter['appVer'];
		$lang 	= $postParameter['lang'];
        		
		$logMsg = sprintf("[ver=%s][appId=%s][appVer=%s][lang=%s][errCode=%s][errMsg=%s]", 
							$ver, 
							$appId,
							$appVer,
							$lang,
							$errCode,
							//$arrErrMsg[$errCode]
							errMsgInc::$arrErrMsg[$errCode]
							);
		foreach ($arrParam as $key => $value)
		{
			$logMsg .= "[$key=$value]";
		}
		
		Logger::err($logMsg, GAME_ERR_LOG_KEY);
		
		return array("ret" => $errCode, "errMsg" => errMsgInc::$arrErrMsg[$errCode]);

	}
	
	public static function writeInfoLog($arrParam = array())
 	{
 		global $postParameter;
 		$ver 	= $postParameter['ver'];
		$appId 	= $postParameter['appId'];
		$appVer = $postParameter['appVer'];
		$lang 	= $postParameter['lang'];
 		$logMsg = sprintf("[ver=%s][appId=%s][appVer=%s][lang=%s]", 
							$ver, 
							$appId,
							$appVer,
							$lang);
		foreach ($arrParam as $key => $value)
		{
			$logMsg .= "[$key=$value]";
		}
		
		Logger::err($logMsg, GAME_INFO_LOG_KEY);
	}
	
	public static function writeTraceLog($arrParam = array())
 	{
// 		$ver 	= $_POST['ver'];
//		$appId 	= $_POST['appId'];
//		$appVer = $_POST['appVer'];
//		$lang 	= $_POST['lang'];
// 		$logMsg = sprintf("[ver=%s][appId=%s][appVer=%s][lang=%s]", 
//							$ver, 
//							$appId,
//							$appVer,
//							$lang);
		$logMsg = "";
		foreach ($arrParam as $key => $value)
		{
			$logMsg .= "[$key=$value]";
		}
		
		Logger::warn($logMsg, GAME_TRACE_LOG_KEY);
	}
	
	
	public static function writeRemoteLog($data = array())
	{
		global $postParameter;
		
		$postData = array_merge($postParameter, $data);
		
		$post = http_build_query($data);
		$len = strlen($post);
		
		$fp = fsockopen($host, $port, $errno, $errstr, 30);
		if (!$fp)
		{
			echo "$errstr ($errno)\n";
			return;
		}
    $out = "POST $path HTTP/1.1\r\n";
    $out .= "Host: $host\r\n";
    $out .= "Content-type: application/x-www-form-urlencoded\r\n";
    $out .= "Connection: Close\r\n";
    $out .= "Content-Length: $len\r\n";
    $out .= "\r\n";
    $out .= $post."\r\n";
    fwrite($fp, $out);


    // get response
                //$response = '';
                //while($row=fread($fp, 4096)){
        //$response .= $row;
    //            }

	}
}
?>